var LW=LW||{};LW.FunnelChartWidget=function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.make=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_style=__webpack_require__(1),Widget=(_interopRequireDefault(_style),function(){function Widget(params){_classCallCheck(this,Widget),this.isButtonSpace=!1,this.tableRowHeight=27,this.chartRowHeight=24,this.params=params,this.title=params.title,this.config=params.config||{},this.headers=params.headers,this.colors=params.colors,this.aiColor=params.aiColor||"#62D2A2",this.series=params.series||[],this.wrapper=this._getWrapper(params.container,this.config.id),this.container=this._getContainer()}return _createClass(Widget,[{key:"render",value:function(data){this.data=data,this.wrapper.append(this.container)}},{key:"_getWrapper",value:function(wrapper,id){var wrapperEl;return wrapper?"string"==typeof wrapper?wrapperEl=document.querySelector(wrapper):wrapper.nodeName&&(wrapperEl=wrapper):(wrapperEl=document.createElement("div"),console.warn("Container not defined.")),wrapperEl.classList.add("wrapper-funnel-bar"),this.config.id&&wrapperEl.setAttribute("id",this.config.id),this.width=wrapperEl.offsetWidth/2-10,wrapperEl}},{key:"_getContainer",value:function(){var container=document.createElement("div");return container.setAttribute("class","funnel-bar"),container.append(this._getChartContainer()),container.append(this._getTableContainer()),container}},{key:"_getTableContainer",value:function(){var container=document.createElement("div");return container.setAttribute("class","funnel-bar-table-container"),container.append(this._getTable()),container}},{key:"_getChartTitle",value:function(){var title=document.createElement("div");return title.setAttribute("class","funnel-bar-title"),title.append(this.title),title}},{key:"_getChartContainer",value:function(){var _this=this,line=d3.line().x(function(d){return d.x}).y(function(d){return d.y}),container=document.createElement("div");container.setAttribute("class","funnel-bar-chart-container"),container.append(this._getChartTitle());var c=d3.select(container).append("svg").attr("width","100%").attr("height",150);return this.series.forEach(function(dataItem,i){c.append("path").attr("d",line(_this._calculatePoints(i))+"Z").style("fill",_this.colors[i]),c.append("path").attr("d",line(_this._calculateUpliftPoints(i))+"Z").style("fill",_this.aiColor)}),container}},{key:"_calculatePoints",value:function(i){return[{x:this.width*(100-this.series[i][2])/100/2,y:i*this.tableRowHeight},{x:this.width-this.width*(100-this.series[i][2])/100/2,y:i*this.tableRowHeight},{x:this.width-this.width*(100-(this.series[i+1]||this.series[i])[2])/100/2,y:i*this.tableRowHeight+this.chartRowHeight},{x:this.width*(100-(this.series[i+1]||this.series[i])[2])/100/2,y:i*this.tableRowHeight+this.chartRowHeight}]}},{key:"_calculateUpliftPoints",value:function(i){return[{x:this.width-this.width*(100-this.series[i][2])/100/2-this.width*(this.series[i][2]/100)*(this.series[i][3]/100),y:i*this.tableRowHeight},{x:this.width-this.width*(100-this.series[i][2])/100/2,y:i*this.tableRowHeight},{x:this.width-this.width*(100-(this.series[i+1]||this.series[i])[2])/100/2,y:i*this.tableRowHeight+this.chartRowHeight},{x:this.width-this.width*(100-(this.series[i+1]||this.series[i])[2])/100/2-this.width*((this.series[i+1]||this.series[i])[2]/100)*((this.series[i+1]||this.series[i])[3]/100),y:i*this.tableRowHeight+this.chartRowHeight}]}},{key:"_getTable",value:function(){var _this2=this,table=document.createElement("table");return table.setAttribute("class","funnel-bar-table"),table.append(this._getTableHeader()),this.series.forEach(function(dataItem,i){table.append(_this2._getTableRow(dataItem,_this2.colors[i]))}),table}},{key:"_getTableRow",value:function(dataRow,color){var _this3=this,tableRow=document.createElement("tr");return tableRow.setAttribute("class","funnel-bar-table-row"),dataRow.forEach(function(dataItem,i){var cell=document.createElement("td");0===i&&cell.append(_this3._getColorBadge(color)),cell.append(dataItem.toLocaleString()),tableRow.append(cell)}),tableRow}},{key:"_getTableHeader",value:function(){var header=document.createElement("thead");header.setAttribute("class","funnel-bar-table-header");var headerTr=document.createElement("tr");return this.headers.forEach(function(field){var cell=document.createElement("th");cell.setAttribute("class","funnel-bar-table-header-cell"),cell.append(field),headerTr.append(cell)}),header.append(headerTr),header}},{key:"_getColorBadge",value:function(color){var colorBadge=document.createElement("div");return colorBadge.setAttribute("class","color-badge"),colorBadge.setAttribute("style","background-color: "+color+";"),colorBadge}}]),Widget}());exports.make=function(params){return new Widget(params)}},function(module,exports,__webpack_require__){"use strict";var content=__webpack_require__(2);"string"==typeof content&&(content=[[module.id,content,""]]);__webpack_require__(4)(content,{});content.locals&&(module.exports=content.locals)},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)(),exports.push([module.id,".wrapper-funnel-bar{font-size:12px;padding:5px 0}.wrapper-funnel-bar .funnel-bar-title{text-align:center;margin-bottom:5px;color:#ccc}.wrapper-funnel-bar .funnel-bar-chart-container,.wrapper-funnel-bar .funnel-bar-table-container{width:calc(50% - 10px);display:inline-block;vertical-align:top}.wrapper-funnel-bar .funnel-bar-chart-container{padding-top:5px;margin-right:20px}.wrapper-funnel-bar table{width:100%}.wrapper-funnel-bar table tr{border-bottom:1px solid #ccc;height:27px}.wrapper-funnel-bar table th{text-transform:uppercase;color:#ccc;font-weight:400;white-space:nowrap}.wrapper-funnel-bar table td:not(:first-child),.wrapper-funnel-bar table th:not(:first-child){text-align:right}.wrapper-funnel-bar table td:not(:first-child){font-weight:700}.wrapper-funnel-bar table td:last-child{color:#62d2a2}.wrapper-funnel-bar table .color-badge{width:10px;height:10px;margin-right:8px;display:inline-block}",""])},function(module,exports){module.exports=function(){var list=[];return list.toString=function(){for(var result=[],i=0;i<this.length;i++){var item=this[i];item[2]?result.push("@media "+item[2]+"{"+item[1]+"}"):result.push(item[1])}return result.join("")},list.i=function(modules,mediaQuery){"string"==typeof modules&&(modules=[[null,modules,""]]);for(var alreadyImportedModules={},i=0;i<this.length;i++){var id=this[i][0];"number"==typeof id&&(alreadyImportedModules[id]=!0)}for(i=0;i<modules.length;i++){var item=modules[i];"number"==typeof item[0]&&alreadyImportedModules[item[0]]||(mediaQuery&&!item[2]?item[2]=mediaQuery:mediaQuery&&(item[2]="("+item[2]+") and ("+mediaQuery+")"),list.push(item))}},list}},function(module,exports,__webpack_require__){function addStylesToDom(styles,options){for(var i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j](item.parts[j]);for(;j<item.parts.length;j++)domStyle.parts.push(addStyle(item.parts[j],options))}else{for(var parts=[],j=0;j<item.parts.length;j++)parts.push(addStyle(item.parts[j],options));stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function listToStyles(list){for(var styles=[],newStyles={},i=0;i<list.length;i++){var item=list[i],id=item[0],css=item[1],media=item[2],sourceMap=item[3],part={css:css,media:media,sourceMap:sourceMap};newStyles[id]?newStyles[id].parts.push(part):styles.push(newStyles[id]={id:id,parts:[part]})}return styles}function insertStyleElement(options,styleElement){var head=getHeadElement(),lastStyleElementInsertedAtTop=styleElementsInsertedAtTop[styleElementsInsertedAtTop.length-1];if("top"===options.insertAt)lastStyleElementInsertedAtTop?lastStyleElementInsertedAtTop.nextSibling?head.insertBefore(styleElement,lastStyleElementInsertedAtTop.nextSibling):head.appendChild(styleElement):head.insertBefore(styleElement,head.firstChild),styleElementsInsertedAtTop.push(styleElement);else{if("bottom"!==options.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");head.appendChild(styleElement)}}function removeStyleElement(styleElement){styleElement.parentNode.removeChild(styleElement);var idx=styleElementsInsertedAtTop.indexOf(styleElement);idx>=0&&styleElementsInsertedAtTop.splice(idx,1)}function createStyleElement(options){var styleElement=document.createElement("style");return styleElement.type="text/css",insertStyleElement(options,styleElement),styleElement}function createLinkElement(options){var linkElement=document.createElement("link");return linkElement.rel="stylesheet",insertStyleElement(options,linkElement),linkElement}function addStyle(obj,options){var styleElement,update,remove;if(options.singleton){var styleIndex=singletonCounter++;styleElement=singletonElement||(singletonElement=createStyleElement(options)),update=applyToSingletonTag.bind(null,styleElement,styleIndex,!1),remove=applyToSingletonTag.bind(null,styleElement,styleIndex,!0)}else obj.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(styleElement=createLinkElement(options),update=updateLink.bind(null,styleElement),remove=function(){removeStyleElement(styleElement),styleElement.href&&URL.revokeObjectURL(styleElement.href)}):(styleElement=createStyleElement(options),update=applyToTag.bind(null,styleElement),remove=function(){removeStyleElement(styleElement)});return update(obj),function(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}function applyToSingletonTag(styleElement,index,remove,obj){var css=remove?"":obj.css;if(styleElement.styleSheet)styleElement.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=styleElement.childNodes;childNodes[index]&&styleElement.removeChild(childNodes[index]),childNodes.length?styleElement.insertBefore(cssNode,childNodes[index]):styleElement.appendChild(cssNode)}}function applyToTag(styleElement,obj){var css=obj.css,media=obj.media;if(media&&styleElement.setAttribute("media",media),styleElement.styleSheet)styleElement.styleSheet.cssText=css;else{for(;styleElement.firstChild;)styleElement.removeChild(styleElement.firstChild);styleElement.appendChild(document.createTextNode(css))}}function updateLink(linkElement,obj){var css=obj.css,sourceMap=obj.sourceMap;sourceMap&&(css+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+" */");var blob=new Blob([css],{type:"text/css"}),oldSrc=linkElement.href;linkElement.href=URL.createObjectURL(blob),oldSrc&&URL.revokeObjectURL(oldSrc)}var stylesInDom={},memoize=function(fn){var memo;return function(){return"undefined"==typeof memo&&(memo=fn.apply(this,arguments)),memo}},isOldIE=memoize(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),getHeadElement=memoize(function(){return document.head||document.getElementsByTagName("head")[0]}),singletonElement=null,singletonCounter=0,styleElementsInsertedAtTop=[];module.exports=function(list,options){options=options||{},"undefined"==typeof options.singleton&&(options.singleton=isOldIE()),"undefined"==typeof options.insertAt&&(options.insertAt="bottom");var styles=listToStyles(list);return addStylesToDom(styles,options),function(newList){for(var mayRemove=[],i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];domStyle.refs--,mayRemove.push(domStyle)}if(newList){var newStyles=listToStyles(newList);addStylesToDom(newStyles,options)}for(var i=0;i<mayRemove.length;i++){var domStyle=mayRemove[i];if(0===domStyle.refs){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}}};var replaceText=function(){var textStore=[];return function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join("\n")}}()}]);